<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title *ngIf="editingMra && !editingMra.mraId">Add Material Resource Available</ion-title>
    <ion-title *ngIf="editingMra && editingMra.mraId">Edit Material Resource Available</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content *ngIf="editingMra">
  <ion-card>
    <ion-card-header>
      <strong *ngIf="editingMra && !editingMra.mraId">Add Material Resource Available</strong>
      <strong *ngIf="editingMra && editingMra.mraId">Edit Material Resource Available</strong>
    </ion-card-header>
    <ion-card-content>
      <form (ngSubmit)="createMaterialResourceRequest(mraForm)" #mraForm="ngForm">
        <ion-item-group>
          <ion-item>
            <ion-label position="stacked">Material Resource Name *</ion-label>
            <ion-input type="text" id="mraName" [ngModel]="editingMra.name" name="mraName" required></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked"> Quantity *</ion-label>
            <ion-input type="text" id="quantity" [ngModel]="editingMra.quantity" name="quantity" required></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked"> Units *</ion-label>
            <ion-select [ngModel]="editingMra.units" name="units" required>
              <ion-select-option value="item(s)"> item(s) </ion-select-option>
              <ion-select-option value="kg"> kg </ion-select-option>
              <ion-select-option value="m"> m </ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Description</ion-label>
            <ion-input type="text" id="description" [ngModel]="editingMra.description" name="description"></ion-input>
          </ion-item>
          <ion-label position="stacked">Material Resource Tags *</ion-label>
          <ion-searchbar [(ngModel)]="searchValue" showcancelbutton="" (ionInput)="filterList($event)"
            [ngModelOptions]="{standalone: true}" placeholder="Search tags"></ion-searchbar>
          <ion-list lines="none" *ngIf="filteredTags.length > 0">
            <ion-item *ngFor="let tag of filteredTags">
              <ion-label button (click)="selectTag(tag)" class="ion-text-wrap">
                <ion-text>
                  <h3>{{tag.name}}</h3>
                </ion-text>
              </ion-label>
            </ion-item>
          </ion-list>
          <ion-list>
            <ion-item *ngFor="let tag of chosenTags" lines="none">
              <ion-chip>
                <ion-label>{{tag.name}} </ion-label>
                <ion-icon name="close-outline" (click)="removeTag(tag)"></ion-icon>
              </ion-chip>
            </ion-item>
          </ion-list>
          <ion-item>
            <ion-label position="stacked">Location of resource</ion-label>
          </ion-item>
          <div id="map_canvas">
          </div>
          <ion-item>
            <ion-label position="stacked">Latitude *</ion-label>
            <ion-input type="text" id="latitude" [ngModel]="editingMra.latitude" name="latitude" required disabled>
            </ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Longitude *</ion-label>
            <ion-input type="text" id="longitude" [ngModel]="editingMra.longitude" name="longitude" required disabled>
            </ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Does your resource expire?</ion-label>
            <ion-toggle [(ngModel)]="hasExpiry" name="hasExpiry" (change)="handleHasExpiryChange()"></ion-toggle>
          </ion-item>
          <ion-item *ngIf="hasExpiry">
            <ion-label position="stacked">Start Date (DD/MM/YYYY):</ion-label>
            <ion-datetime required name="startDate" placeholder="DD/MM/YYYY" [min]="minDate" [max]="maxDate" display-format="DD/MM/YYYY"
              [(ngModel)]="editingMraStartDate">
            </ion-datetime>
          </ion-item>
          <ion-item *ngIf="hasExpiry">
            <ion-label position="stacked">End Date (DD/MM/YYYY):</ion-label>
            <ion-datetime required name="endDate" placeholder="DD/MM/YYYY" display-format="DD/MM/YYYY"
              [min]="editingMraStartDate" [max]="maxDate" [(ngModel)]="editingMraEndDate">
            </ion-datetime>
          </ion-item>
        </ion-item-group>
        <div class="modal-footer justify-content-between">
          <ion-button type="submit" [disabled]="!mraForm.valid" expand="block" *ngIf="!editingMra.mraId">Submit
          </ion-button>
          <ion-button type="submit" [disabled]="!mraForm.valid" expand="block" *ngIf="editingMra.mraId">Save
          </ion-button>
        </div>
      </form>
    </ion-card-content>
  </ion-card>
</ion-content>